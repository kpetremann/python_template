[tox]
envlist = py38-test,lint
toxworkdir={env:TEMPDIR:/tmp/.tox}-build-current/app/

[testenv:lint]
skip_install = True
deps =
    -rrequirements/dev.txt
commands =
  pylama
  black --check .
  isort --check --diff . app/
  bandit -r app/

[testenv:format]
deps =
  unimport
  isort
  black
commands =
  - unimport app/ --gitignore -p
  isort app/
  black app/

[testenv:grammar]
deps =
  codespell
commands =
  codespell website --skip="*.png,*.js,*.pyc,*.jpg,*.ttf,*.eot,*.woff2,*.sqlite3,*.gif,*.webp,*.html,*.css"

[testenv:bundle]
basepython = {env:PYTHON:python}
deps =
  pex
commands =
  {envpython} setup.py sdist --dist-dir=sdist --format=gztar
  {envpython} setup.py bdist_pex --bdist-dir=dist --pex-args='--disable-cache' --bdist-all